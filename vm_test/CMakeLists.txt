cmake_minimum_required(VERSION 3.10)

project(vm_test C)

macro(add_run_test name)
  add_test(NAME "run_${name}" COMMAND bash "${CMAKE_CURRENT_SOURCE_DIR}/run_test.sh" "${runner_BINARY_DIR}/runner" "${CMAKE_CURRENT_SOURCE_DIR}/../test_programs/${name}")
endmacro()

macro(add_run_stderr_test name)
  add_test(NAME "run_${name}" COMMAND bash "${CMAKE_CURRENT_SOURCE_DIR}/run_test_stderr.sh" "${runner_BINARY_DIR}/runner" "${CMAKE_CURRENT_SOURCE_DIR}/../test_programs/${name}")
endmacro()

add_run_test(return_1)
add_run_test(multiply_21_and_2)
add_run_test(fact_recursive)
add_run_test(fact_iterative)
add_run_test(fact_iterative_34)
add_run_test(string_compare)
add_run_test(string_concat)
add_run_test(string_concat_compare)
add_run_test(index_array)
add_run_test(resize_array)
add_run_test(move_array)
add_run_test(fact_iterative_5000)
add_run_test(sum_iterative_10000000)
add_run_test(internal_function)
add_run_test(equals)
add_run_test(array_length)
add_run_test(force_marksweep)

add_run_test(prim_is_type)
add_run_test(prim_math)
add_run_test(prim_display_number)
add_run_test(prim_display_float)
add_run_test(prim_display_singletons)
add_run_test(prim_display_string)
add_run_test(prim_pair)
add_run_test(prim_list)
add_run_test(prim_map)
add_run_test(prim_map_arrays)
add_run_test(prim_map_primitive)
add_run_test(prim_equal)
add_run_test(prim_set_pair)
add_run_test(prim_length)

if(${SINTER_DEBUG_LOGLEVEL} EQUAL 2)
  add_run_stderr_test(prim_display)
  add_run_stderr_test(prim_error)
endif()
